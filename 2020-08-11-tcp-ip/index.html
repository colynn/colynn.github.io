<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=author content="Colynn.Liu"><link rel=prev href=https://colynn.github.io/2020-06-19-npm-catch-error/><link rel=canonical href=https://colynn.github.io/2020-08-11-tcp-ip/><link rel=apple-touch-icon sizes=180x180 href=/img/home-icon.png><link rel=icon type=image/png sizes=32x32 href=/img/favicon.png><link rel=icon type=image/png sizes=16x16 href=/img/favicon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>TCP/IP 协议 | Colynn.Liu</title><meta name=title content="TCP/IP 协议 | Colynn.Liu"><link rel=stylesheet href=/font/iconfont.css><link rel=stylesheet href=/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/colynn.github.io\/"},"articleSection":"posts","name":"TCP\/IP 协议","headline":"TCP\/IP 协议","description":"基础知识 具体含义 利用IP进行通信时所必须用到的协议的统称。 具体来说，IP 或 ICMP、TCP或 UDP、 TELNET或是 FTP、HTTP 等都属于","inLanguage":"zh-CN","author":"Colynn.Liu","creator":"Colynn.Liu","publisher":"Colynn.Liu","accountablePerson":"Colynn.Liu","copyrightHolder":"Colynn.Liu","copyrightYear":"2020","datePublished":"2020-08-11 00:00:00 \u002b0000 UTC","dateModified":"2020-08-11 00:00:00 \u002b0000 UTC","url":"https:\/\/colynn.github.io\/2020-08-11-tcp-ip\/","wordCount":"979","keywords":["tcp","Colynn.Liu"]}</script></head><body><div class=wrapper><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href=https://colynn.github.io/>Colynn.Liu</a></div><div class="menu navbar-right"><a class=menu-item href=/posts/>文章</a>
<a class=menu-item href=/categories/>分类</a>
<a class=menu-item href=/tags/>标签</a>
<a class=menu-item href=/aboutme/>关于我</a></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><div class=container><div class=navbar-header><div><a href=https://colynn.github.io/>Colynn.Liu</a></div><div class=menu-toggle><span></span><span></span><span></span></div></div><div class=menu id=mobile-menu><a class=menu-item href=/posts/>文章</a>
<a class=menu-item href=/categories/>分类</a>
<a class=menu-item href=/tags/>标签</a>
<a class=menu-item href=/aboutme/>关于我</a></div></div></nav><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">TCP/IP 协议</h1><div class=post-meta>Written by <a itemprop=name href=https://colynn.github.io/ rel=author>Colynn.Liu</a> with ♥
<span class=post-time>on <time datetime=2020-08-11 itemprop=datePublished>August 11, 2020</time></span>
<span class=post-time>- last modified <time datetime=2020-08-11 itemprop=datePublished>August 11, 2020</time></span></div><div class=post-tags><section><span class=tag><a href=https://colynn.github.io/tags/tcp/><i class="iconfont icon-tag"></i>tcp</a></span></section><section><i class="iconfont icon-folder"></i><span class=post-category><a href=https://colynn.github.io/categories/%E5%8D%8F%E8%AE%AE/>协议</a></span></section></div></header><div class=post-content><h2 id=基础知识>基础知识</h2><h3 id=具体含义>具体含义</h3><p>利用IP进行通信时所必须用到的协议的统称。 具体来说，IP 或 ICMP、TCP或 UDP、 TELNET或是 FTP、HTTP 等都属于 TCP/IP 的协议。它们与 TCP或 IP 的关系紧密，是互联网必不可以少的组成部分。TCP/IP 一词泛指这些协议，因此，有时也称TCP/IP为国际协议族。</p><p><img src=https://user-images.githubusercontent.com/5203608/89868390-4d5aa000-dbe5-11ea-8596-2c25a6acf0bf.png alt=image></p><h2 id=tcp头部信息>TCP头部信息</h2><p><strong>注</strong>: 指定通信的源端口号、目的端端口号、管理 TCP连接， 控制两个方向的数据流</p><p><img src=https://user-images.githubusercontent.com/5203608/89868541-8c88f100-dbe5-11ea-87df-01f5c0577201.png alt=image></p><h3 id=tcp报文各个位置详解>TCP报文各个位置详解</h3><ol><li><p>源端口号：数据发起者的端口号，16bit</p></li><li><p>目的端口号：数据接收者的端口号，16bit</p></li><li><p>序号：32bit的序列号，由发送方使用</p></li><li><p>确认序号：32bit的确认号，是接收数据方期望收到发送方的下一个报文段的序号，因此确认序号应当是上次已成功收到数据字节序号加1</p></li><li><p>（数据偏移）首部长度：首部中32bit字的数目，可表示15*32bit=60字节的首部。一般首部长度为20字节。</p></li><li><p>保留：6bit，均为0</p></li><li><p>紧急URG：当URG=1时，表示报文段中有紧急数据，应尽快传送；</p></li><li><p>确认比特ACK：ACK = 1时代表这是一个确认的TCP包，取值0则不是确认包；</p></li><li><p>推送比特PSH：当发送端PSH=1时，接收端尽快的交付给应用进程；</p></li><li><p>复位比特（RST）：当RST=1时，表明TCP连接中出现严重差错，必须释放连接，再重新建立连接；</p></li><li><p>同步比特SYN：在建立连接时用来同步的序号。SYN=1,ACK=0表示一个连接请求报文段。SYN=1，ACK=1表示同意建立连接。</p></li><li><p>终止比特FIN：FIN=1时，表明此报文段的发送端的数据已经发送完毕，并要求释放传输连接。</p></li><li><p>窗口：用来控制对方发送的数据量，通知发放已确定的发送窗口上限。</p></li><li><p>校验和：该字段检验的范围包括首部和数据这两部分。由发端计算和存储，并由收端进行验证。</p></li><li><p>紧急指针：紧急指针在URG=1时才有效，它指出本报文段中的紧急数据的字节数。</p></li><li><p>选项：长度可变，最长可达40字节。</p></li></ol><h3 id=wireshark-捕获到的tcp包的每个字段-如下图所示>wireshark 捕获到的TCP包的每个字段 如下图所示：</h3><p><img src=https://user-images.githubusercontent.com/5203608/89869523-0a013100-dbe7-11ea-9eaa-51ad595e22ed.png alt=image></p><h2 id=tcp-三次握手>TCP 三次握手</h2><p>tcp 建立连接时会有三次握手，如下图所示，抓包获取到了三次握手的三个数据包，第四个包才是 http(应用数据包)。</p><p><img src=https://user-images.githubusercontent.com/5203608/89892956-164ab580-dc0a-11ea-86bf-696af982f95d.png alt=image></p><h3 id=tcp三次握手流程图>TCP三次握手流程图</h3><p><img src=https://user-images.githubusercontent.com/5203608/89893858-b94fff00-dc0b-11ea-8bc8-cc35a784e56e.png alt=image></p><h2 id=tcp-四次挥手>TCP 四次挥手</h2><p>TCP断开连接时，会有四次断开过程，如下图所示，wireshark截获到了四次断开的四个数据包。</p><p><img src=https://user-images.githubusercontent.com/5203608/89894547-d5a06b80-dc0c-11ea-863d-e047070c540d.png alt=image></p><h3 id=tcp四次挥手流程图>TCP四次挥手流程图</h3><p><img src=https://user-images.githubusercontent.com/5203608/89894616-f4066700-dc0c-11ea-82b5-87c54d44afb5.png alt=image></p><h2 id=疑问>疑问</h2><h3 id=为什么-time_wait-状态需要2倍的mslmaximum-segment-lifetime长度>为什么 TIME_WAIT 状态需要2倍的MSL(Maximum segment lifetime)长度？</h3><ol><li>To implement TCP&rsquo;s full-duplex connection termination reliably</li><li>To allow old duplicate segments to expire in the network</li></ol></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>Colynn.Liu</span></p><p class=copyright-item><span>Link:</span>
<a href=https://colynn.github.io/2020-08-11-tcp-ip/>https://colynn.github.io/2020-08-11-tcp-ip/</span></p><p class="copyright-item lincese">本文采用<a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/ target=_blank>知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p></div><div class=post-tags><section><i class="iconfont icon-tag"></i>Tag(s):
<span class=tag><a href=https://colynn.github.io/tags/tcp/>#tcp</a></span></section><section><a href=javascript:window.history.back();>back</a></span> ·
<span><a href=https://colynn.github.io/>home</a></span></section></div><div class=post-nav><a href=https://colynn.github.io/2020-06-19-npm-catch-error/ class=prev rel=prev title=npm使用过程中的报错记录><i class="iconfont icon-left"></i>&nbsp;npm使用过程中的报错记录</a></div><div class=post-comment><div id=gitalk-container></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css><script src=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js></script><script>const gitalk=new Gitalk({clientID:'7196948b9a586a342072',clientSecret:"1acf6a13bc1ce7b8d8e3554789781ba2aaa4575c",repo:"blog-comments",owner:"colynn",admin:"colynn",id:"/2020-08-11-tcp-ip/",distractionFreeMode:false,perPage:100});gitalk.render('gitalk-container')</script></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2018 - 2020</span>
<span class=with-love><i class="iconfont icon-love"></i></span><span class=author itemprop=copyrightHolder><a href=https://colynn.github.io/>Colynn.Liu</a> |</span>
<span><a href=https://colynn.github.io/friends>友情链接</a></span></div></footer><link href=//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css rel=stylesheet><script src=/js/vendor_gallery.min.js async></script></div></body></html>