<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=author content="Colynn.Liu"><meta name=description content="Full-Stack DevOps, Be focused and Practical"><link rel=prev href=https://colynn.github.io/2019-09-26-vscode_env_setting/><link rel=next href=https://colynn.github.io/2020-03-03-beego_using/><link rel=canonical href=https://colynn.github.io/2019-10-22-kubernetes-ci-cd/><link rel=apple-touch-icon sizes=180x180 href=/img/home-icon.png><link rel=icon type=image/png sizes=32x32 href=/img/favicon.png><link rel=icon type=image/png sizes=16x16 href=/img/favicon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>Kubernetes CI/CD 基于开源组件的实践 | Colynn.Liu</title><meta name=title content="Kubernetes CI/CD 基于开源组件的实践 | Colynn.Liu"><link rel=stylesheet href=/font/iconfont.css><link rel=stylesheet href=/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/colynn.github.io\/"},"articleSection":"posts","name":"Kubernetes CI\/CD 基于开源组件的实践","headline":"Kubernetes CI\/CD 基于开源组件的实践","description":"前言 应对敏捷开发的需求，对CI(持续集成))\/CD（持续交付）的提出了更高的标准，今天来讨论下，如何基于开源组件（gitlab\/jenkin","inLanguage":"zh-CN","author":"Colynn.Liu","creator":"Colynn.Liu","publisher":"Colynn.Liu","accountablePerson":"Colynn.Liu","copyrightHolder":"Colynn.Liu","copyrightYear":"2019","datePublished":"2019-10-22 00:00:00 \u002b0000 UTC","dateModified":"2019-10-22 00:00:00 \u002b0000 UTC","url":"https:\/\/colynn.github.io\/2019-10-22-kubernetes-ci-cd\/","wordCount":"3564","keywords":["kubernetes","devops","Colynn.Liu"]}</script></head><body><div class=wrapper><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href=https://colynn.github.io/>Colynn.Liu</a></div><div class="menu navbar-right"><a class=menu-item href=/posts/>文章</a>
<a class=menu-item href=/categories/>分类</a>
<a class=menu-item href=/tags/>标签</a>
<a class=menu-item href=/aboutme/>关于我</a></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><div class=container><div class=navbar-header><div><a href=https://colynn.github.io/>Colynn.Liu</a></div><div class=menu-toggle><span></span><span></span><span></span></div></div><div class=menu id=mobile-menu><a class=menu-item href=/posts/>文章</a>
<a class=menu-item href=/categories/>分类</a>
<a class=menu-item href=/tags/>标签</a>
<a class=menu-item href=/aboutme/>关于我</a></div></div></nav><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">Kubernetes CI/CD 基于开源组件的实践</h1><div class=post-meta>Written by <a itemprop=name href=https://colynn.github.io/ rel=author>Colynn.Liu</a> with ♥
<span class=post-time>on <time datetime=2019-10-22 itemprop=datePublished>October 22, 2019</time></span>
<span class=post-time>- last modified <time datetime=2019-10-22 itemprop=datePublished>October 22, 2019</time></span></div><div class=post-tags><section><span class=tag><a href=https://colynn.github.io/tags/kubernetes/><i class="iconfont icon-tag"></i>kubernetes</a></span>
<span class=tag><a href=https://colynn.github.io/tags/devops/><i class="iconfont icon-tag"></i>devops</a></span></section><section><i class="iconfont icon-folder"></i><span class=post-category><a href=https://colynn.github.io/categories/%E6%95%99%E7%A8%8B/>教程</a></span></section></div></header><div class=post-content><h2 id=前言>前言</h2><p>应对敏捷开发的需求，对CI(持续集成))/CD（持续交付）的提出了更高的标准，今天来讨论下，如何基于开源组件（gitlab/jenkins/harbor/kubernetes）使用CI/CD，赋能团队的开发、运维。</p><h2 id=核心组件>核心组件</h2><table><thead><tr><th>组件名称</th><th>版本</th><th>备注</th></tr></thead><tbody><tr><td>kubernetes</td><td>v1.15.3</td><td>10.0.0.182:6443</td></tr><tr><td>jenkins</td><td>2.176.2</td><td>集群内部署/ namespace: devops</td></tr><tr><td>gitlab</td><td>11.8</td><td>主机部署</td></tr><tr><td>harbor</td><td>v1.7.4</td><td>docker-compose部署</td></tr></tbody></table><h2 id=基本流程>基本流程</h2><ol><li>在GitLab创建对应的项目。</li><li>开发者将代码提交到GitLab。</li><li>Jenkins创建对应的任务（Job），集成该项目的Git地址和Kubernetes集群。</li><li>如有配置钩子，推送（Push）代码会自动触发Jenkins构建，如没有配置钩子，需要手动构建。</li><li>Jenkins控制Kubernetes（使用的是Kubernetes插件）创建Jenkins Slave。</li><li>Jenkins Slave根据流水线（Pipeline）定义的步骤执行构建。<ol><li>检出代码、打包、编译；</li><li>通过Dockerfile生成镜像。</li><li>将镜像提送（Push）到私有Harbor。</li><li>Jenkins再次控制Kubernetes进行最新的镜像部署。</li></ol></li></ol><p><strong>注</strong>:</p><ul><li><p>上面所述为一般步骤，中间还可能会涉及自动化测试等步骤，可自行根据业务场景添加。</p></li><li><p>上面流水线步骤一般由应用代码库的根目录下Jenkinsfile决定，Jenkins会自动读取该文件；另外如果需要对具体的应用流水线实施强管控，可以独立管理jenkinsfile模板，然后根据jenkins API接口即时生成流水线。</p></li><li><p>默认使用的Dockerfile放置在代码仓库的根目录下。</p></li></ul><h2 id=组件部署>组件部署</h2><ol><li>kubernetes【Kubernetes系列】第3篇 Kubernetes集群安装部署</li><li>gitlab 无忌过招:手把手教你搭建自己的GitLab库</li><li>harbor <a href=https://github.com/goharbor/harbor/blob/v1.7.4/docs/installation_guide.md>安装配置指南</a></li><li>jenkins</li></ol><p><em>注</em>: 本文主要说明下jenkins的部署及配置，其他组件如果你部署有问题，欢迎留言。</p><h2 id=jenkins-部署及配置>Jenkins 部署及配置</h2><p><em>说明</em>:</p><ul><li><p>以下的yaml文件均在 k8s master节点的 /home/jenkins_deploy目录下，</p></li><li><p>部署示例的depployment.yaml 的注解</p><ul><li><code>nodeName ipaddress</code> , ipaddress 请确认其为一个有效的ip.</li><li>示例中jenkins的目录 <code>/var/jenkins_home</code> 是直接挂载到host_path, 如果你有条件，建议替换为共享存储。</li><li>因使用的jenkins-master 的基础镜像来自公网，需要k8s maste 节点也要可以访问外网，或者你可以将 <code>jenkins/jenkins:lts-alpine</code> 推送至自己的内网镜像仓库。</li></ul></li><li><p>部署示例的ingress.yaml 的注解</p><ul><li>需要你也需要办公网（集群外）访问，请将<code>jenkins.dev.hanker.net</code>, 改为有效的域名地址，或是你也可以通过<code>NodePort</code>的形式声明 service，就可以直接通过<code>ip:port</code>的形式访问jenkins了。</li></ul></li></ul><h3 id=1-准备部署yaml>1. 准备部署yaml</h3><ul><li>deployment.yaml</li></ul><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#080;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>kind</span>:<span style=color:#bbb> </span>Namespace<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>name</span>:<span style=color:#bbb> </span>devops<span style=color:#bbb>
</span><span style=color:#bbb>  
</span><span style=color:#bbb></span><span style=color:#888># Deployment </span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>extensions/v1beta1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>name</span>:<span style=color:#bbb> </span>jenkins<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>namespace</span>:<span style=color:#bbb> </span>devops<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#60e;font-weight:700>1</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>revisionHistoryLimit</span>:<span style=color:#bbb> </span><span style=color:#60e;font-weight:700>3</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>template</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#080;font-weight:700>labels</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#080;font-weight:700>app</span>:<span style=color:#bbb> </span>jenkins<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#080;font-weight:700>nodeName</span>:<span style=color:#bbb> </span><span style=color:#60e;font-weight:700>1.1.1.1</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#080;font-weight:700>serviceAccountName</span>:<span style=color:#bbb> </span>jenkins-admin<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#080;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:#080;font-weight:700>image</span>:<span style=color:#bbb> </span>jenkins/jenkins:lts-alpine<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#080;font-weight:700>imagePullPolicy</span>:<span style=color:#bbb> </span>IfNotPresent<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#080;font-weight:700>name</span>:<span style=color:#bbb> </span>jenkins<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#080;font-weight:700>volumeMounts</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:#080;font-weight:700>name</span>:<span style=color:#bbb> </span>jenkins-volume<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#080;font-weight:700>mountPath</span>:<span style=color:#bbb> </span>/var/jenkins_home<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:#080;font-weight:700>name</span>:<span style=color:#bbb> </span>jenkins-localtime<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#080;font-weight:700>mountPath</span>:<span style=color:#bbb> </span>/etc/localtime<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#080;font-weight:700>env</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span>- <span style=color:#080;font-weight:700>name</span>:<span style=color:#bbb> </span>JAVA_OPTS<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:#080;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=background-color:#fff0f0>&#39;-Xms256m -Xmx1024m -Duser.timezone=Asia/Shanghai&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>          </span>- <span style=color:#080;font-weight:700>name</span>:<span style=color:#bbb> </span>TRY_UPGRADE_IF_NO_MARKER<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:#080;font-weight:700>value</span>:<span style=color:#bbb> </span><span style=background-color:#fff0f0>&#39;true&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#080;font-weight:700>ports</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:#080;font-weight:700>name</span>:<span style=color:#bbb> </span>http<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#080;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#60e;font-weight:700>8080</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:#080;font-weight:700>name</span>:<span style=color:#bbb> </span>agent<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#080;font-weight:700>containerPort</span>:<span style=color:#bbb> </span><span style=color:#60e;font-weight:700>50000</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#080;font-weight:700>resources</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#080;font-weight:700>requests</span>:<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:#080;font-weight:700>cpu</span>:<span style=color:#bbb> </span>1000m<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:#080;font-weight:700>memory</span>:<span style=color:#bbb> </span>1Gi<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#080;font-weight:700>limits</span>:<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:#080;font-weight:700>cpu</span>:<span style=color:#bbb> </span>1200m<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:#080;font-weight:700>memory</span>:<span style=color:#bbb> </span>2Gi<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#080;font-weight:700>volumes</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:#080;font-weight:700>name</span>:<span style=color:#bbb> </span>jenkins-localtime<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#080;font-weight:700>hostPath</span>:<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:#080;font-weight:700>path</span>:<span style=color:#bbb> </span>/etc/localtime<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:#080;font-weight:700>name</span>:<span style=color:#bbb> </span>jenkins-volume<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#080;font-weight:700>hostPath</span>:<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:#080;font-weight:700>path</span>:<span style=color:#bbb> </span>/home/jenkins/jenkins_home<span style=color:#bbb>
</span></code></pre></div><ul><li>配置service, services.yaml</li></ul><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>---<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>kind</span>:<span style=color:#bbb> </span>Service<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>name</span>:<span style=color:#bbb> </span>jenkins-service<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>namespace</span>:<span style=color:#bbb> </span>devops<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>ports</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:#080;font-weight:700>name</span>:<span style=color:#bbb> </span>http<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-weight:700>protocol</span>:<span style=color:#bbb> </span>TCP<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-weight:700>port</span>:<span style=color:#bbb> </span><span style=color:#60e;font-weight:700>8080</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-weight:700>targetPort</span>:<span style=color:#bbb> </span><span style=color:#60e;font-weight:700>8080</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:#080;font-weight:700>port</span>:<span style=color:#bbb> </span><span style=color:#60e;font-weight:700>50000</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-weight:700>targetPort</span>:<span style=color:#bbb> </span><span style=color:#60e;font-weight:700>50000</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-weight:700>name</span>:<span style=color:#bbb> </span>agent<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>selector</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-weight:700>app</span>:<span style=color:#bbb> </span>jenkins<span style=color:#bbb>
</span></code></pre></div><ul><li>授权jenkins对k8s的访问 rbac.yaml</li></ul><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#080;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>kind</span>:<span style=color:#bbb> </span>ServiceAccount<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>labels</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-weight:700>k8s-app</span>:<span style=color:#bbb> </span>jenkins<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>name</span>:<span style=color:#bbb> </span>jenkins-admin<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>namespace</span>:<span style=color:#bbb> </span>devops<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb></span>---<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io/v1beta1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>kind</span>:<span style=color:#bbb> </span>ClusterRole<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>name</span>:<span style=color:#bbb> </span>jenkins-rbac<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>namespace</span>:<span style=color:#bbb> </span>devops<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>rules</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:#080;font-weight:700>apiGroups</span>:<span style=color:#bbb> </span>[<span style=background-color:#fff0f0>&#34;&#34;</span>,<span style=background-color:#fff0f0>&#34;extensions&#34;</span>,<span style=background-color:#fff0f0>&#34;app&#34;</span>]<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-weight:700>resources</span>:<span style=color:#bbb> </span>[<span style=background-color:#fff0f0>&#34;pods&#34;</span>,<span style=background-color:#fff0f0>&#34;pods/exec&#34;</span>,<span style=background-color:#fff0f0>&#34;deployments&#34;</span>,<span style=background-color:#fff0f0>&#34;replicasets&#34;</span>]<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-weight:700>verbs</span>:<span style=color:#bbb> </span>[<span style=background-color:#fff0f0>&#34;get&#34;</span>,<span style=background-color:#fff0f0>&#34;list&#34;</span>,<span style=background-color:#fff0f0>&#34;watch&#34;</span>,<span style=background-color:#fff0f0>&#34;create&#34;</span>,<span style=background-color:#fff0f0>&#34;update&#34;</span>,<span style=background-color:#fff0f0>&#34;patch&#34;</span>,<span style=background-color:#fff0f0>&#34;delete&#34;</span>]<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb></span>---<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io/v1beta1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>kind</span>:<span style=color:#bbb> </span>ClusterRoleBinding<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>name</span>:<span style=color:#bbb> </span>jenkins-admin<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>namespace</span>:<span style=color:#bbb> </span>devops<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>labels</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-weight:700>k8s-app</span>:<span style=color:#bbb> </span>jenkins<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>subjects</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:#080;font-weight:700>kind</span>:<span style=color:#bbb> </span>ServiceAccount<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-weight:700>name</span>:<span style=color:#bbb> </span>jenkins-admin<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-weight:700>namespace</span>:<span style=color:#bbb> </span>devops<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>roleRef</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>kind</span>:<span style=color:#bbb> </span>ClusterRole<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>name</span>:<span style=color:#bbb> </span>jenkins-rbac<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>apiGroup</span>:<span style=color:#bbb> </span>rbac.authorization.k8s.io<span style=color:#bbb>
</span></code></pre></div><ul><li>为了便于办公网（集群外）访问，ingress.yaml</li></ul><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#080;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>extensions/v1beta1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>kind</span>:<span style=color:#bbb> </span>Ingress<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>name</span>:<span style=color:#bbb> </span>jenkins-ingress<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>namespace</span>:<span style=color:#bbb> </span>devops<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#080;font-weight:700>rules</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:#080;font-weight:700>host</span>:<span style=color:#bbb> </span>jenkins.dev.hanker.net<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-weight:700>http</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#080;font-weight:700>paths</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:#080;font-weight:700>backend</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#080;font-weight:700>serviceName</span>:<span style=color:#bbb> </span>jenkins-service<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#080;font-weight:700>servicePort</span>:<span style=color:#bbb> </span><span style=color:#60e;font-weight:700>8080</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#080;font-weight:700>path</span>:<span style=color:#bbb> </span>/<span style=color:#bbb>
</span></code></pre></div><h3 id=2-应用yaml部署jenkins>2. 应用yaml，部署jenkins</h3><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ <span style=color:#007020>pwd</span>
$ /home/jenkins_deploy
$ kubectl apply -f *.yaml
</code></pre></div><h3 id=3-确认jenkins-服务状态>3. 确认jenkins 服务状态</h3><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#333>[</span>root@node0 jenkins_deploy<span style=color:#333>]</span><span style=color:#888># kubectl -n devops get deployment jenkins</span>
NAME      READY   UP-TO-DATE   AVAILABLE   AGE
jenkins   1/1     <span style=color:#60e;font-weight:700>1</span>            <span style=color:#60e;font-weight:700>1</span>           51d
<span style=color:#333>[</span>root@node0 jenkins_deploy<span style=color:#333>]</span># 
</code></pre></div><h3 id=4-访问jenkins-安装插件设置>4. 访问jenkins 安装插件、设置</h3><p><em>注:</em> 步骤1 声明的域名 <code>jenkins.dev.hanker.net</code> 已经解析至ingress，故可直接访问； 如果你也想通过自定义域名访问jenkins，麻请解析至正确的ingress服务节点，即可。</p><ol><li>确认你也已经安装了kubernetes/ kubernetes cli 插件</li></ol><p><em>操作指引</em>： 【Manage Jenkins】 -> 【Manage Plugins】</p><p>你应该可以通过类似的指令获取jenkins-master的密码</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ kubectl -n devops <span style=color:#007020>exec</span> jenkins-pod-name cat /var/jenkins_home/secrets/initialAdminPassword
</code></pre></div><p><img src=https://user-images.githubusercontent.com/5203608/89489195-7f7e9300-d7dc-11ea-96d4-51d7868a542a.png alt=image></p><ol start=2><li>配置Kubernetes 插件</li></ol><p><em>操作指引</em>： 【Manage Jenkins】->【Configure System】</p><p><img src=https://user-images.githubusercontent.com/5203608/89489205-84434700-d7dc-11ea-84f6-ea526dc85e1c.png alt=image></p><p><img src=https://user-images.githubusercontent.com/5203608/89489214-886f6480-d7dc-11ea-9cfb-f4c90dd4f21c.png alt=image></p><p><em>图中标注：</em></p><ol><li><p>请修改为你所在环境对应的k8s master</p></li><li><p>声明jenkins-agent 的命令空间，也可以根据需要调整；</p></li><li><p>jenkins-master的访问地址，本示例使用的是 service-name的形式访问。</p></li><li><p>测试与k8s分享群的连接情况。如果你获取到『
Connection test successful』，恭喜你可以继续。</p></li><li><p>配置Kubernetes Pod Template</p></li></ol><p><img src=https://user-images.githubusercontent.com/5203608/89489216-8c9b8200-d7dc-11ea-84b1-3fcc7e1e915f.png alt=image></p><p><em>图中标注：</em></p><ol><li><p>设置基础的jenkins-agent镜像, 参考下篇附录：1. 自定义jenkins-agent镜像；</p></li><li><p>指定工作目录；</p><ul><li>如果你需要下载、导出或是缓存构建的话，指定一个为共享存储的目录就很有意义了。</li></ul></li><li><p>设置目录挂载</p><ul><li>如步骤2如说，你可以将宿主机的目录或是网络存储挂载至jenkins-agent.</li></ul></li></ol><h2 id=cicd---全流程实践>CI/CD - 全流程实践</h2><h2 id=前言-1>前言</h2><ol><li>本实践中已经的示例代码及jenkins-agent镜像已经推送归档至github，<a href=https://github.com/Kubernetes-Best-Pratice/>&ndash;>传送门</a></li><li>注意本实践中均为内网数据，你测试时一定要改为自己的环境的有效数据。</li><li>由于本实践涉及组件较多，若有操作不明确的话，你可以后台留言，我们一起完善。</li><li>具体操作时若有不清楚，或是错误可以留言，大家一起解决。</li></ol><h3 id=1-准备基础数据>1. 准备基础数据</h3><ol><li>配置gitlab</li></ol><ul><li>创建项目</li><li>上传示例代码</li></ul><p><em>注</em>: 本次示例使用的gitlab项目地址为：<code>http://gitlab.hanker.com/colynn/hanker-hello.git</code></p><ol start=2><li>配置harbor</li></ol><ul><li>创建项目, 用于存储构建的镜像
<em>注</em>: 本次示例使用的harbor地址为 <code>10.0.0.185:5000/hanker/hanker-hello:v1</code></li></ul><ol start=3><li>jenkins 验证信息</li></ol><ul><li>添加 gitlab 帐号信息</li></ul><p><em>操作指引</em>：【Credentials】-> 【System】-> 【Global credentials】-> 【Add Credentials】</p><p><img src=https://user-images.githubusercontent.com/5203608/89489317-c40a2e80-d7dc-11ea-9632-4d26094bc007.png alt=image></p><ul><li>harbor 信息</li></ul><p><em>操作指引</em>：【Credentials】-> 【System】-> 【Global credentials】-> 【Add Credentials】</p><p><img src=https://user-images.githubusercontent.com/5203608/89489324-c79db580-d7dc-11ea-8926-9457a77aa465.png alt=image></p><ul><li>k8s namespace验证信息</li></ul><p>在你的k8s master节点上执行如下操作：</p><ol><li>创建serviceaccount</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ kubectl -n devops create serviceaccount jenkins-robot
</code></pre></div><p>命令输出：</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>serviceaccount/jenkins-robot created
</code></pre></div><ol start=2><li>角色绑定</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ kubectl -n devops create rolebinding jenkins-robot-binding --clusterrole<span style=color:#333>=</span>cluster-admin --serviceaccount<span style=color:#333>=</span>devops:jenkins-robot
</code></pre></div><p>命令输出：</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>rolebinding.rbac.authorization.k8s.io/jenkins-robot-binding created
</code></pre></div><ol start=3><li>获取 ServiceAccount</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ kubectl -n devops get serviceaccount jenkins-robot -o go-template --template<span style=color:#333>=</span><span style=background-color:#fff0f0>&#39;{{range .secrets}}{{.name}}{{&#34;\n&#34;}}{{end}}&#39;</span>
</code></pre></div><p>jenkins-robot-token-n8w6b</p><ol start=4><li>基于base64解码 ServiceToken</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ kubectl -n devops get secrets jenkins-robot-token-n8w6b -o go-template --template <span style=background-color:#fff0f0>&#39;{{index .data &#34;token&#34;}}&#39;</span> | base64 --decode
</code></pre></div><p>命令输出：</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZXZvcHMiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlY3JldC5uYW1lIjoiamVua2lucy1yb2JvdC10b2tlbi1uOHc2YiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJqZW5raW5zLXJvYm90Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiOTcyZTY0OGYtMTYxZC00NmM5LWI0ZjgtYjFkNTdlOWY4NTBjIiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRldm9wczpqZW5raW5zLXJvYm90In0.ArQvcaEqCaeU1ZcJ6nOC5rLaTZr_vLDrpLCt87asltMUWj2gSli_mXUTrl09hBnBDXI3A1D4rJXHKLHjIAA4nN8qRIRGbpqSNzDwmqJr-jmmmWWZFrZ3n3Al9-13KJnNOK8pcWr70rt3Rsigt4B6CIQ0-ZLK8BZhvROJSifeOfJ6xe2KBqdXBv1ccZZZfEhPLgGbaR5yWm5jLvOMr2MQiPDrZoHOEkcMt-C0xipytOp4sJCJ4bQhb-UoMu1owYydxbd6O7xO71fvqP_bMDpZXC601nA2ggK7h-vi6CJffHv5MM59q8X_DWe1NnZS6KXiMmkXqAmBn10Yu20PNj-kjg
</code></pre></div><ol start=5><li>添加 <code>Secret text</code>验证信息</li></ol><p><em>操作指引</em>：【首页】->【Credentials】-> 【System】-> 【Global credentials】-> 【Add Credentials】-> 选择【Secret text】类型</p><p>然后将上一步 解码的结果 更新至 <code>Secret</code>, Pipeline 中</p><p><img src=https://user-images.githubusercontent.com/5203608/89489334-cec4c380-d7dc-11ea-8ef7-90ff6eb42ed6.png alt=image></p><h3 id=2-如何创建-jenkins-pipeline>2. 如何创建 jenkins pipeline</h3><h4 id=1-创建jenkins-pipeline-item>1. 创建jenkins pipeline item</h4><p><em>操作指引</em>：【首页】->【New Item】</p><p><img src=https://user-images.githubusercontent.com/5203608/89489341-d5533b00-d7dc-11ea-9cc1-efa4953e6ed4.png alt=image></p><h4 id=2-pipeline-script-步骤说明>2. pipeline script 步骤说明</h4><p><em>注</em>: pipeline主要包含三个阶段（检出代码、制作镜像、部署服务），下面跟大家解释下，如何编写pipeline， 借助Pipeline Syntax生成的只是部分代码，你可以根据语言规范将其完善。</p><ol><li>阶段1，检出代码</li></ol><p><em>操作指引</em>：【首页】->【hanker-hello-demo】-> 【Pipeline Syntax】</p><p><img src=https://user-images.githubusercontent.com/5203608/89489344-d84e2b80-d7dc-11ea-8584-ada6c0888e1e.png alt=image></p><p><em>注</em>: 本实践中选取的 <code>git: Git</code> 类型，当然你也可以选择 <code>checkout: Check out from version control</code></p><p>获取到该步骤的脚本</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>git credentialsId: <span style=background-color:#fff0f0>&#39;gitlab-project-auth&#39;</span>, url: <span style=background-color:#fff0f0>&#39;http://gitlab.hanker.com/colynn/hanker-hello.git&#39;</span>
</code></pre></div><ol start=2><li>阶段2，构建镜像
<em>操作指引</em>：类似于 阶段1，</li></ol><p><img src=https://user-images.githubusercontent.com/5203608/89489671-983b7880-d7dd-11ea-9578-a3a3d2cffb60.png alt=image></p><p>完善获取该步骤脚本</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>script <span style=color:#333>{</span>
    withDockerRegistry<span style=color:#333>(</span>credentialsId: <span style=background-color:#fff0f0>&#39;harbor-auth&#39;</span>, url: <span style=background-color:#fff0f0>&#39;http://10.0.0.185:5000&#39;</span><span style=color:#333>)</span> <span style=color:#333>{</span>
        def <span style=color:#963>customImage</span> <span style=color:#333>=</span>  docker.build<span style=color:#333>(</span><span style=background-color:#fff0f0>&#34;10.0.0.185:5000/devops/hanker-hello:v1&#34;</span><span style=color:#333>)</span>
        customImage.push<span style=color:#333>()</span>
    <span style=color:#333>}</span>
<span style=color:#333>}</span>
</code></pre></div><p><em>注</em>: 支持本阶段需要jenkins-agent镜像里包含docker命令。</p><ol start=3><li>阶段3. 部署服务</li></ol><p><em>参考</em>: <a href=https://github.com/jenkinsci/kubernetes-cli-plugin/blob/master/README.md>jenkins kubernetes cli plugin</a></p><p><em>注</em>: 支持本阶段需要jenkins-agent镜像里包含kubectl命令。</p><h4 id=3-设置-pipeline>3. 设置 pipeline</h4><p><em>注</em>:</p><ul><li>General/ Build Triggers/ Advanced Project Options 这三块你可以根据自己需要设置，将各阶段的脚本合并，更新至 Pipline -> Script内。</li></ul><p>合并后的pipeline脚本内容如下：</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>pipeline <span style=color:#333>{</span>
    agent any
    stages <span style=color:#333>{</span>
        stage<span style=color:#333>(</span><span style=background-color:#fff0f0>&#39;checkout&#39;</span><span style=color:#333>)</span> <span style=color:#333>{</span>
            steps <span style=color:#333>{</span>
                git credentialsId: <span style=background-color:#fff0f0>&#39;gitlab-project-auth&#39;</span>, url: <span style=background-color:#fff0f0>&#39;http://gitlab.hanker.com/colynn/hanker-hello.git&#39;</span>    
            <span style=color:#333>}</span>
        <span style=color:#333>}</span>
        
        stage<span style=color:#333>(</span><span style=background-color:#fff0f0>&#39;docker-publish&#39;</span><span style=color:#333>)</span> <span style=color:#333>{</span>
            steps<span style=color:#333>{</span>
                script <span style=color:#333>{</span>
                    withDockerRegistry<span style=color:#333>(</span>credentialsId: <span style=background-color:#fff0f0>&#39;harbor-auth&#39;</span>, url: <span style=background-color:#fff0f0>&#39;http://10.0.0.185:5000&#39;</span><span style=color:#333>)</span> <span style=color:#333>{</span>
                        def <span style=color:#963>customImage</span> <span style=color:#333>=</span>  docker.build<span style=color:#333>(</span><span style=background-color:#fff0f0>&#34;10.0.0.185:5000/devops/hanker-hello:v1&#34;</span><span style=color:#333>)</span>
                        customImage.push<span style=color:#333>()</span>
                    <span style=color:#333>}</span>
                <span style=color:#333>}</span>
            <span style=color:#333>}</span>
        <span style=color:#333>}</span>
        
        stage<span style=color:#333>(</span><span style=background-color:#fff0f0>&#39;application-deploy&#39;</span><span style=color:#333>)</span> <span style=color:#333>{</span>
            steps <span style=color:#333>{</span>
                withKubeConfig<span style=color:#333>([</span>credentialsId: <span style=background-color:#fff0f0>&#39;5a5517f3-3d38-459d-bafc-12b55beeb588&#39;</span>, serverUrl: <span style=background-color:#fff0f0>&#39;https://10.0.0.182:6443&#39;</span><span style=color:#333>])</span> <span style=color:#333>{</span>
                    sh <span style=background-color:#fff0f0>&#39;/usr/bin/kubectl apply -f k8s-setup.yml&#39;</span>
                <span style=color:#333>}</span>
            <span style=color:#333>}</span>
        <span style=color:#333>}</span>
    <span style=color:#333>}</span>
<span style=color:#333>}</span>

</code></pre></div><p><img src=https://user-images.githubusercontent.com/5203608/89489714-ae493900-d7dd-11ea-950a-c8a3b976bc0a.png alt=image></p><h3 id=3-触发构建>3. 触发构建</h3><p><img src=https://user-images.githubusercontent.com/5203608/89489721-b1442980-d7dd-11ea-98d2-f33ca788c96b.png alt=image></p><h3 id=4-结果确认>4. 结果确认</h3><ol><li>确认 jenkina-agent 启动状态；</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ kubectl -n devops get pods |grep jnlp
jnlp-sh8zl                                 1/1     Running   <span style=color:#60e;font-weight:700>0</span>          14s

// 查看jenkins-agent pod日志
$ kubectl -n devops logs -f <span style=color:#333>[</span>jenkins-agent-pod-name<span style=color:#333>]</span>
</code></pre></div><p><em>注</em>: 如果长时间没有启动jenkins-agent, 可以确认下集群内是否有足够的资源。</p><ol start=2><li>确认pipeline 执行状态；</li></ol><p><img src=https://user-images.githubusercontent.com/5203608/89489728-b7d2a100-d7dd-11ea-8b1d-190dcdb8478c.png alt=image></p><ol start=3><li>确认harbor镜像仓库里是否已经有新推送的镜像</li></ol><p><img src=https://user-images.githubusercontent.com/5203608/89489736-bdc88200-d7dd-11ea-8260-896fb3ae2915.png alt=image></p><p><em>注</em>: harbor里的项目是需要你先创建好的，不然推送时会报错。</p><ol start=4><li>确认部署的服务状态</li></ol><p>k8s master节点上执行如下操作:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ kubectl -n devops get pod,deployment,svc,ingress |grep hanker-hello 

pod/hanker-hello-5b7586f86d-5j7kk              1/1     Running   <span style=color:#60e;font-weight:700>0</span>          173m


deployment.extensions/hanker-hello              1/1     <span style=color:#60e;font-weight:700>1</span>            <span style=color:#60e;font-weight:700>1</span>           3h8m
service/hanker-hello-svc          ClusterIP   10.233.22.19    &lt;none&gt;        8080/TCP             3h8m
ingress.extensions/hanker-hello-ingress              hanker-hello-demo.dev.hanker.net                   <span style=color:#60e;font-weight:700>80</span>      3h8m
</code></pre></div><p><img src=https://user-images.githubusercontent.com/5203608/89489740-c28d3600-d7dd-11ea-8133-2ff07be556ea.png alt=image></p><h2 id=附录>附录</h2><h3 id=1自定义jenkins-agent镜像>1.自定义jenkins-agent镜像</h3><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#888>## 基于 https://github.com/Kubernetes-Best-Pratice/jenkins-jnlp-agent.git</span>

$ git checkout  https://github.com/Kubernetes-Best-Pratice/jenkins-jnlp-agent.git

$ <span style=color:#007020>cd</span> jenkins-jnlp-agent
$ docker build .
$ docker tag tag-name custom-private-repository-addr

</code></pre></div><p><em>注</em>: 你也可以基于<a href=https://github.com/jenkinsci/docker-jnlp-slave>基础镜像</a>创建自定义的镜像</p><h2 id=可以做的更完善>可以做的更完善</h2><ol><li>配置webhook, 自动触发jenkins job;</li><li>当前我们实践时构建的镜像版本使用的是固定的, 你是否可以将其替换为依赖pipeline环境变量或是传参的形式，将其变是更有意义；</li><li>上一篇文章中在设置【配置Kubernetes Pod Template】时，我们提到可以挂载主机或是网络共享存储，你是否可以通过这个将你的构建快起来；</li><li>我们的示例代码使用的go, 直接是镜像内打包，如何更好的就好的其他语言的构建，你可以参考<a href=https://jenkins.io/doc/book/pipeline/docker/>Using Docker with Pipeline</a>；</li><li>你想过如何下载构建过程中的产物吗，等等。</li></ol><p>参考链接 ：</p><ol><li><p><a href=https://github.com/jenkinsci/kubernetes-cli-plugin/blob/master/README.md>https://github.com/jenkinsci/kubernetes-cli-plugin/blob/master/README.md</a></p></li><li><p>下载kubectl: <a href=https://docs.docker.com/ee/ucp/user-access/kubectl/>https://docs.docker.com/ee/ucp/user-access/kubectl/</a></p></li></ol></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>Colynn.Liu</span></p><p class=copyright-item><span>Link:</span>
<a href=https://colynn.github.io/2019-10-22-kubernetes-ci-cd/>https://colynn.github.io/2019-10-22-kubernetes-ci-cd/</span></p><p class="copyright-item lincese">本文采用<a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/ target=_blank>知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p></div><div class=post-tags><section><i class="iconfont icon-tag"></i>Tag(s):
<span class=tag><a href=https://colynn.github.io/tags/kubernetes/>#kubernetes</a></span>
<span class=tag><a href=https://colynn.github.io/tags/devops/>#devops</a></span></section><section><a href=javascript:window.history.back();>back</a></span> ·
<span><a href=https://colynn.github.io/>home</a></span></section></div><div class=post-nav><a href=https://colynn.github.io/2019-09-26-vscode_env_setting/ class=prev rel=prev title="VSCode 开发环境设置"><i class="iconfont icon-left"></i>&nbsp;VSCode 开发环境设置</a>
<a href=https://colynn.github.io/2020-03-03-beego_using/ class=next rel=next title="Beego In Use">Beego In Use&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment><div id=gitalk-container></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css><script src=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js></script><script>const gitalk=new Gitalk({clientID:'7196948b9a586a342072',clientSecret:"1acf6a13bc1ce7b8d8e3554789781ba2aaa4575c",repo:"blog-comments",owner:"colynn",admin:"colynn",id:"/2019-10-22-kubernetes-ci-cd/",distractionFreeMode:false,perPage:100});gitalk.render('gitalk-container')</script></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2018 - 2020</span>
<span class=with-love><i class="iconfont icon-love"></i></span><span class=author itemprop=copyrightHolder><a href=https://colynn.github.io/>Colynn.Liu</a> |</span>
<span><a href=https://colynn.github.io/friends>友情链接</a></span></div></footer><link href=//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css rel=stylesheet><script src=/js/vendor_gallery.min.js async></script></div></body></html>